---
title: "04-Sapwood_Parameters"
output: html_document
---

# Key Wood Traits

## Sapwood osmotic water potential at saturation

- ED variable name : `wood_psi_osmotic`
- ED variable units: `m`

Negative units in BETY so we can fit a distribution! 
- BETY varaible units: `-m`

### Prior data?

- FATES varaiable name: `pinot_node (stem)`
- FATES variable units: `m`

### Conversion
`MPa to m`

```{r calc wood_psi_osmotic}
i <- which(priors$ED_name == "wood_psi_osmotic")
prior_in <- priors[i, stats] * MPa2m

myfit <- prior_get_fit(prior_in, accepted_dists, plot = TRUE)
myfit$score$dist[which.min(myfit$score$RMSE)]

variable_id.in <- tbl(bety,"variables") %>% filter(name == priors$ED_name[i]) %>% pull(id)
phylogeny.in <- "plants"

best.fit.name <- myfit$score$dist[which.min(myfit$score$RMSE)]
best.fit.dat <- myfit$dists %>% select(one_of("Name", best.fit.name)) %>% rename(value := !!best.fit.name, params = Name)

wood_psi_osmotic_prior_id <- prior_input(bety, variable_id.in, phylogeny.in, 
                                         dist.name.in = best.fit.name, 
                                         parama.in = best.fit.dat %>% filter(params == "Para1") %>% pull(value), 
                                         paramb.in = best.fit.dat %>% filter(params == "Para2") %>% pull(value), 
                                         paramc.in = best.fit.dat %>% filter(params == "Para3") %>% pull(value))
```
```{r plot wood_psi_osmotic}
wood_psi_osmotic_fit <- tbl(bety, "priors") %>% filter(id == wood_psi_osmotic_prior_id) %>% collect()
wood_psi_osmotic_prior <- -rdistn(wood_psi_osmotic_fit)
wood_psi_osmotic_default <- get_ED_default(PFT3_defaults_history, "wood_psi_osmotic")

prior_plot(prior = wood_psi_osmotic_prior, 
           q = c(0,1), 
           plot_default = wood_psi_osmotic_default,
           title = sprintf("Sapwood osmotic water potential at saturation (wood_psi_osmotic): %s", wood_psi_osmotic_fit$distn),
           type = "data")
```

## Sapwood bulk elastic modulus

- ED variable name : `wood_elastic_mod`
- ED variable units: `MPa` Note! This is the only case in which MPa is used instead of m!

### Prior data? 

- FATES varaiable name: `epsil_node (stem)` 
- FATES variable units: `MPa`

### Conversion

None!

```{r calc wood_elastic_mod}
i <- which(priors$ED_name == "wood_elastic_mod")
prior_in <- priors[i,]
myfit <- prior_get_fit(prior_in, accepted_dists, plot = TRUE)

variable_id.in <- tbl(bety,"variables") %>% filter(name == priors$ED_name[i]) %>% pull(id)
phylogeny.in <- "plants"

best.fit.name <- myfit$score$dist[which.min(myfit$score$RMSE)]
best.fit.dat <- myfit$dists %>% select(one_of("Name", best.fit.name)) %>% rename(value := !!best.fit.name, params = Name)

wood_elastic_mod_id <- prior_input(bety, variable_id.in, phylogeny.in, 
                                   dist.name.in = best.fit.name, 
                                   parama.in = best.fit.dat %>% filter(params == "Para1") %>% pull(value), 
                                   paramb.in = best.fit.dat %>% filter(params == "Para2") %>% pull(value), 
                                   paramc.in = best.fit.dat %>% filter(params == "Para3") %>% pull(value))

```


```{r plot wood_elastic_mod}
wood_elastic_mod_fit <- tbl(bety, "priors") %>% filter(id == wood_elastic_mod_id) %>% collect()
wood_elastic_mod_prior <- rdistn(wood_elastic_mod_fit)
wood_elastic_mod_default <- get_ED_default("/fs/data3/ecowdery/ED.Hydro/parameters/pft3_defaults_history.xml", "wood_elastic_mod")

prior_plot(prior = wood_elastic_mod_prior, 
           q = c(0,1), 
           plot_default = wood_elastic_mod_default,
           title = sprintf("wood bulk elastic modulus (wood_elastic_mod): %s", wood_elastic_mod_fit$distn),
           type = "data")
```

## Sapwood water content at saturation

- ED variable name: `wood_water_sat`
- ED variable units: `kg H2O/kg biomass`

### Prior data?

- FATES variable name: `thetas_node (stem)`
- FATES variable units: `kg kg-1`

### Conversion 

multiply by the density of water over wood density

```{r calc wood_water_sat}
i <- which(priors$ED_name == "wood_water_sat")
myfit_0 <- prior_get_fit(priors[i,], accepted_dists, plot = FALSE)  

myfit_0$score$dist[which.min(myfit_0$score$RMSE)]
# I'm skipping steps here for the sake of time and sanity
# Normal is the best fit
wood_water_sat_prior_0 <- rnorm(100000, myfit_0$dists$norm[1], myfit_0$dists$norm[2])

wood_water_sat_sample <- wood_water_sat_prior_0 * (wdns/(wood_density_prior * 1e3)) 
# Note that here we have to multiply by 1e3 because of the units of wood density 

# In this case I'm not using the function I built because here it wouldn't make sense. 
prior_in <- data.frame(low.025 =  quantile(wood_water_sat_sample, c(.025), na.rm = TRUE),
                       low.25  =  quantile(wood_water_sat_sample, c(.25), na.rm = TRUE),
                       mean    =  quantile(wood_water_sat_sample, c(.5), na.rm = TRUE), 
                       upp.75  =  quantile(wood_water_sat_sample, c(.75), na.rm = TRUE), 
                       upp.975 =  quantile(wood_water_sat_sample, c(.975), na.rm = TRUE))
myfit <- prior_get_fit(prior_in, accepted_dists, plot = TRUE)

variable_id.in <- tbl(bety,"variables") %>% filter(name == priors$ED_name[i]) %>% pull(id)
phylogeny.in <- "plants"

best.fit.name <- myfit$score$dist[which.min(myfit$score$RMSE)]
best.fit.dat <- myfit$dists %>% select(one_of("Name", best.fit.name)) %>% rename(value := !!best.fit.name, params = Name)

wood_water_sat_prior_id <- prior_input(bety, variable_id.in, phylogeny.in, 
                                       dist.name.in = best.fit.name, 
                                       parama.in = best.fit.dat %>% filter(params == "Para1") %>% pull(value), 
                                       paramb.in = best.fit.dat %>% filter(params == "Para2") %>% pull(value), 
                                       paramc.in = best.fit.dat %>% filter(params == "Para3") %>% pull(value))
```
```{r plot wood_water_sat}
wood_water_sat_fit <- tbl(bety, "priors") %>% filter(id == wood_water_sat_prior_id) %>% collect()
wood_water_sat_prior <- rdistn(wood_water_sat_fit)
wood_water_sat_density <- get_ED_default("/fs/data3/ecowdery/ED.Hydro/parameters/pft3_defaults_history.xml", "wood_water_sat")

prior_plot(prior = wood_water_sat_prior, 
           q = c(0,.995),
           plot_default = wood_water_sat_density,
           title = sprintf("Wood water content at saturation (wood_water_sat): %s", wood_water_sat_fit$distn),
           type = "mixed")
```

## Sapwood water potential at turgor loss point

- ED variable name:  `wood_psi_tlp`
- ED variable units: `m`

Negative units in BETY so we can fit a distribution! 

- BETY varaible units: `-m`

## Prior data?

There is a FATES parameter but it is calculated from other parameters

- FATES variable name: `pitlp_node`
- FATES variable units: `MPa`

Constraints we added
- `wood_psi_tlp > .1 MPa` (this was given as a boundary for other psi variables)

### Calculation and conversion 

- Calculated from other parameters: `wood_psi_osmotic` and `wood_elastic_mod`

- Remember that `wood_elastic_mod` is `MPa`, where everything else is `m`! 

```
wood_psi_tlp_samp = 
(wood_psi_osmotic_prior * wood_elastic_mod_prior * MPa2m)/
(wood_psi_osmotic_prior + wood_elastic_mod_prior * MPa2m)
```

```{r calc wood_psi_tlp_samp}
wood_psi_tlp_samp <- 
  (wood_psi_osmotic_prior * wood_elastic_mod_prior * MPa2m)/
  (wood_psi_osmotic_prior + wood_elastic_mod_prior * MPa2m)

summary(wood_psi_tlp_samp)

i <- which(priors$ED_name == "wood_psi_tlp")
prior_in <- priors[i,stats] * MPa2m # Convert from MPa to m
prior_in <- prior_add_samp_data(prior_in, samp = -wood_psi_tlp_samp)
prior_in[,stats]

myfit <- prior_get_fit(prior_in, accepted_dists, plot = TRUE)

variable_id.in <- tbl(bety, "variables") %>% filter(name == "wood_psi_tlp") %>% pull(id)
phylogeny.in <- "plants"

best.fit.name <- myfit$score$dist[which.min(myfit$score$RMSE)]
best.fit.dat <- myfit$dists %>% select(one_of("Name", best.fit.name)) %>% rename(value := !!best.fit.name, params = Name)

wood_psi_tlp_prior_id <- prior_input(bety, variable_id.in, phylogeny.in, 
                                     dist.name.in = best.fit.name, 
                                     parama.in = best.fit.dat %>% filter(params == "Para1") %>% pull(value), 
                                     paramb.in = best.fit.dat %>% filter(params == "Para2") %>% pull(value), 
                                     paramc.in = best.fit.dat %>% filter(params == "Para3") %>% pull(value))

```

```{r plot wood_psi_tlp}
wood_psi_tlp_fit <- tbl(bety, "priors") %>% filter(id == wood_psi_tlp_prior_id) %>% collect()
wood_psi_tlp_prior <- -rdistn(wood_psi_tlp_fit) # Remember to flip back over for psi
wood_psi_tlp_default <- get_ED_default("/fs/data3/ecowdery/ED.Hydro/parameters/pft3_defaults_history.xml", "wood_psi_tlp")

# plot(density(wood_psi_tlp_prior), main = "wood_psi_tlp prior")
# abline(v = get_ED_default("/fs/data3/ecowdery/ED.Hydro/parameters/pft3_defaults_history.xml", "wood_psi_tlp"), col = "blue", lwd = 2)
# abline(v = quantile(wood_psi_osmotic_prior, c(.025, .975)), lty = 2)
# legend("topleft",legend=c("Prior", "95% CI", "ED PFT 3 Default"), col=c("black", "black","blue"), lwd = c(2,1,2), lty = c(1,2,1))

prior_plot(prior = wood_psi_tlp_prior, 
           q = c(.005,1),
           plot_default = wood_psi_tlp_default,
           title = sprintf("(wood_psi_tlp): %s", wood_psi_tlp_fit$distn),
           type = "equation")


```

## Wood hydaulic capacitance. 

- ED variable name : `wood_water_cap`
- ED variable units: `kg H2O/kg biomass/m`

Different units in BETY so we can fit a distribution!
The numbers were so small that I couldn't get the fitting function to work until
I scaled the variable up!

- BETY varaible units: `g H2O / kg biomass / m`

### Prior data?

No FATES variables

Constraints we added
- `wood_water_cap > 1e-07 kg H2O/kg biomass/m` 

### Calculation

Calculated entirely from priors


```{r calc wood_water_cap}
wood_water_cap_samp <- 
  1000 * (1 - wood_psi_osmotic_prior / (4 * wood_psi_tlp_prior)) * 
  (wood_water_sat_prior / (4 * abs(wood_psi_tlp_prior))) 

summary(wood_water_cap_samp)

i <- which(priors$ED_name == "wood_water_cap")
prior_in <- priors[i,stats] 
prior_in <- prior_add_samp_data(prior_in, samp = wood_water_cap_samp)
prior_in[,stats]

myfit <- prior_get_fit(prior_in, accepted_dists, plot = TRUE)

variable_id.in <- tbl(bety, "variables") %>% filter(name == "wood_water_cap") %>% pull(id)
phylogeny.in <- "plants"

best.fit.name <- myfit$score$dist[which.min(myfit$score$RMSE)]
best.fit.dat <- myfit$dists %>% select(one_of("Name", best.fit.name)) %>% rename(value := !!best.fit.name, params = Name)

wood_water_cap_prior_id <- prior_input(bety, variable_id.in, phylogeny.in, 
                                       dist.name.in = best.fit.name, 
                                       parama.in = best.fit.dat %>% filter(params == "Para1") %>% pull(value), 
                                       paramb.in = best.fit.dat %>% filter(params == "Para2") %>% pull(value), 
                                       paramc.in = best.fit.dat %>% filter(params == "Para3") %>% pull(value))

```
```{r plot wood_water_cap}
wood_water_cap_fit <- tbl(bety, "priors") %>% filter(id == wood_water_cap_prior_id) %>% collect()
wood_water_cap_prior <- rdistn(wood_water_cap_fit) * (1/1000) # Convert back to kg
wood_water_cap_default <- get_ED_default("/fs/data3/ecowdery/ED.Hydro/parameters/pft3_defaults_history.xml", "wood_water_cap")

prior_plot(prior = wood_water_cap_prior, 
           q = c(0,.975),
           plot_default = wood_water_cap_default,
           title = sprintf("(wood_water_cap): %s", wood_water_cap_fit$distn),
           type = "equation")

```

## Sapwood minimum relative water content or Sapwood residual fraction

- ED variable name : `wood_psi_min`
- Ed variable units: `m`

Negative units in BETY so we can fit a distribution! 

- BETY varaible units: `-m`

## Prior data?

There are no FATES parameters 

Constraints we added
- `wood_psi_min > .1 MPa` (this was given as a boundary for other psi variables)

### Calculation 

Calculated from other priors. 

Should I put `wood_rwc_min` and `rwc_tlp_wood` in the database too?

```{r}
rwc_tlp_wood_samp <- 1. - (1. - 0.75 * wood_density_prior) / (2.74 + 2.01 * wood_density_prior) 
wood_rwc_min_samp = wood_elastic_mod_prior * (1. - rwc_tlp_wood_samp) / (wood_psi_osmotic_prior / MPa2m) + 1.
wood_psi_min_samp = (wood_rwc_min_samp - 1.) * wood_water_sat_prior / wood_water_cap_prior

# Add in the max an min from the priors table
i <- which(priors$ED_name == "wood_psi_min")
prior_in <- priors[i,stats] * MPa2m # Convert from MPa to m
prior_in <- prior_add_samp_data(prior_in, samp = -wood_psi_min_samp)
prior_in[,stats]

myfit <- prior_get_fit(prior_in, accepted_dists, plot = TRUE)

variable_id.in <- tbl(bety, "variables") %>% filter(name == "wood_psi_min") %>% pull(id)
phylogeny.in <- "plants"

best.fit.name <- myfit$score$dist[which.min(myfit$score$RMSE)]
best.fit.dat <- myfit$dists %>% select(one_of("Name", best.fit.name)) %>% rename(value := !!best.fit.name, params = Name)

wood_psi_min_prior_id <- prior_input(bety, variable_id.in, phylogeny.in, 
                                     dist.name.in = best.fit.name, 
                                     parama.in = best.fit.dat %>% filter(params == "Para1") %>% pull(value), 
                                     paramb.in = best.fit.dat %>% filter(params == "Para2") %>% pull(value), 
                                     paramc.in = best.fit.dat %>% filter(params == "Para3") %>% pull(value))
```

```{r}
wood_psi_min_fit <- tbl(bety, "priors") %>% filter(id == wood_psi_min_prior_id) %>% collect()
wood_psi_min_prior <- -rdistn(wood_psi_min_fit) # Remember to flip psi
default_wood_psi_min <- get_ED_default("/fs/data3/ecowdery/ED.Hydro/parameters/pft3_defaults_history.xml", "wood_psi_min")

prior_plot(prior = wood_psi_min_prior, 
           q = c(.025,1), 
           plot_default = default_wood_psi_min,
           title = sprintf("wood_psi_min: %s", wood_psi_min_fit$distn), 
           type = "equation")
```

## Maximum hydraulic conductivity of the stem

- ED variable name : `wood_Kmax`
- ED variable units: `kg H2O / m / s` Note! This is the only case in which MPa is used instead of m!

### Prior data? 

- FATES varaiable name: `kmax_node` 
- FATES variable units: `kg m-1 s-1 MPa-1` 

### Conversion

I don't think we need to multiply by the density of water  ... which is confusing. 

```{r calc wood_Kmax}
i <- which(priors$ED_name == "wood_Kmax")

prior_in <- priors[i, stats] / MPa2m
myfit <- prior_get_fit(prior_in, accepted_dists, plot = TRUE)
myfit$score$dist[which.min(myfit$score$RMSE)]

variable_id.in <- tbl(bety,"variables") %>% filter(name == priors$ED_name[i]) %>% pull(id)
phylogeny.in <- "plants"

best.fit.name <- myfit$score$dist[which.min(myfit$score$RMSE)]
best.fit.dat <- myfit$dists %>% select(one_of("Name", best.fit.name)) %>% rename(value := !!best.fit.name, params = Name)

wood_Kmax_prior_id <- prior_input(bety, variable_id.in, phylogeny.in, 
                                  dist.name.in = best.fit.name, 
                                  parama.in = best.fit.dat %>% filter(params == "Para1") %>% pull(value), 
                                  paramb.in = best.fit.dat %>% filter(params == "Para2") %>% pull(value), 
                                  paramc.in = best.fit.dat %>% filter(params == "Para3") %>% pull(value))
```

```{r plot wood_Kmax}
wood_Kmax_fit <- tbl(bety, "priors") %>% filter(id == wood_Kmax_prior_id) %>% collect()
wood_Kmax_prior <- rdistn(wood_Kmax_fit) # NOTE: Need to convert to m from -m 
wood_Kmax_default <- get_ED_default("/fs/data3/ecowdery/ED.Hydro/parameters/pft3_defaults_history.xml", "wood_Kmax")

prior_plot(prior = wood_Kmax_prior, 
           q = c(0,.975), 
           plot_default = wood_Kmax_default,
           title = sprintf("Maximum hydraulic conductivity of the stem (wood_Kmax): %s", wood_Kmax_fit$distn),
           type = "data")
```


## Water potential at which 50% of stem conductivity is lost

- ED variable name : `wood_psi50`
- ED variable units: `m` 

NOTE: There is an *ERROR* in the ED code for the equation for `wood_psi50`

Should be:

`(-1.09-(3.57 * rho(ipft) ^ 1.73) * MPa2m`

Negative units in BETY so we can fit a distribution! 

- BETY varaible units: `-m`

### Prior data?

- FATES varaiable name: `p50_node (stem)`
- FATES variable units: `MPa`

### Conversion
`MPa to m`

This one is tricky, do we keep the normal distribution because it's the best fit?

```{r calc wood_psi50}
i <- which(priors$ED_name == "wood_psi50")

prior_in <- priors[i, stats] * MPa2m
prior_in

myfit <- prior_get_fit(prior_in, accepted_dists, plot = TRUE)
myfit$score$dist[which.min(myfit$score$RMSE)]

variable_id.in <- tbl(bety,"variables") %>% filter(name == priors$ED_name[i]) %>% pull(id)
phylogeny.in <- "plants"

best.fit.name <- myfit$score$dist[which.min(myfit$score$RMSE)]
best.fit.dat <- myfit$dists %>% select(one_of("Name", best.fit.name)) %>% rename(value := !!best.fit.name, params = Name)

wood_psi50_prior_id <- prior_input(bety, variable_id.in, phylogeny.in, 
                                   dist.name.in = best.fit.name, 
                                   parama.in = best.fit.dat %>% filter(params == "Para1") %>% pull(value), 
                                   paramb.in = best.fit.dat %>% filter(params == "Para2") %>% pull(value), 
                                   paramc.in = best.fit.dat %>% filter(params == "Para3") %>% pull(value))
```

```{r plot wood_psi50}
wood_psi50_fit <- tbl(bety, "priors") %>% filter(id == wood_psi50_prior_id) %>% collect()
wood_psi50_prior <- -rdistn(wood_psi50_fit) # NOTE: Need to convert to m from -m 

# Calculating default by hand because it is calculated wrong in ED! 
wood_psi50_default <- (-1.09 - (3.57 * default_wood_density ^ 1.73)) * MPa2m
wrong_wood_psi50_default <- get_ED_default(PFT3_defaults_history, "wood_psi50")

p <- prior_plot(prior = wood_psi50_prior, 
                q = c(0,1), 
                plot_default = wood_psi50_default,
                title = sprintf("Water potential at which 50perc. of stem cond. is lost (wood_psi50): %s", wood_psi50_fit$distn),
                type = "data") 

p + 
  geom_vline(aes(xintercept = wrong_wood_psi50_default), color = "gray", linetype = "dashed") + 
  geom_vline(aes(xintercept = quantile(wood_psi50_prior, .975)), color = "blue", linetype = "dashed")
quantile(wood_psi50_prior, .975)
```

A positive number is within the 95% CI of the distribution so in this case,
I'm going to choose a log normal distriburtion even though it is not the best fit. 
Hopefully this can also be fixed given that we have data for both psi50 and Kexp... 

```{r recalc and plot wood_psi50}

best.fit.name <- "lnorm"
best.fit.dat <- myfit$dists %>% select(one_of("Name", best.fit.name)) %>% rename(value := !!best.fit.name, params = Name)

wood_psi50_prior_id <- prior_input(bety, variable_id.in, phylogeny.in, 
                                   dist.name.in = best.fit.name, 
                                   parama.in = best.fit.dat %>% filter(params == "Para1") %>% pull(value), 
                                   paramb.in = best.fit.dat %>% filter(params == "Para2") %>% pull(value), 
                                   paramc.in = best.fit.dat %>% filter(params == "Para3") %>% pull(value))

wood_psi50_fit <- tbl(bety, "priors") %>% filter(id == wood_psi50_prior_id) %>% collect()
wood_psi50_prior <- -rdistn(wood_psi50_fit) # NOTE: Need to convert to m from -m 

# Calculating default by hand because it is calculated wrong in ED! 
wood_psi50_default <- (-1.09 - (3.57 * default_wood_density ^ 1.73)) * MPa2m
wrong_wood_psi50_default <- get_ED_default(PFT3_defaults_history, "wood_psi50")

prior_plot(prior = wood_psi50_prior, 
           q = c(0.025,1), 
           plot_default = wood_psi50_default,
           title = sprintf("Water potential at which 50perc. of stem cond. is lost (wood_psi50): %s", wood_psi50_fit$distn),
           type = "data") 
```

## Exponent for the hydraulic vulnerability curve of stem conductivity 
... under the Weibull function `1/(1+(psi/psi50) ^ Kexp_stem)`

- ED variable name : `wood_Kexp`
- ED variable units: unitless 

### Prior data? 

- FATES varaiable name: `avuln_node (stem)` 
- FATES variable units: unitless

### Conversion

None! 

### Calculation 

```{r}
i <- which(priors$ED_name == "wood_Kexp")

prior_in <- priors[i, stats]
prior_in

myfit <- prior_get_fit(prior_in, accepted_dists, plot = TRUE)
myfit$score$dist[which.min(myfit$score$RMSE)]

variable_id.in <- tbl(bety,"variables") %>% filter(name == priors$ED_name[i]) %>% pull(id)
phylogeny.in <- "plants"

best.fit.name <- myfit$score$dist[which.min(myfit$score$RMSE)]
best.fit.dat <- myfit$dists %>% select(one_of("Name", best.fit.name)) %>% rename(value := !!best.fit.name, params = Name)

wood_Kexp_prior_id <- prior_input(bety, variable_id.in, phylogeny.in, 
                                   dist.name.in = best.fit.name, 
                                   parama.in = best.fit.dat %>% filter(params == "Para1") %>% pull(value), 
                                   paramb.in = best.fit.dat %>% filter(params == "Para2") %>% pull(value), 
                                   paramc.in = best.fit.dat %>% filter(params == "Para3") %>% pull(value))
```

```{r}
wood_Kexp_fit <- tbl(bety, "priors") %>% filter(id == wood_Kexp_prior_id) %>% collect()
wood_Kexp_prior <- rdistn(wood_Kexp_fit)

# Calculating default by hand because psi50 is calculated wrong in ED!
wood_Kexp_default <- 0.544 * 4. * (-wood_psi50_default / MPa2m) ^ (-0.17)
wrong_wood_Kexp_default <- get_ED_default(PFT3_defaults_history, "wood_Kexp")

p <- prior_plot(prior = wood_Kexp_prior, 
                q = c(0,.975), 
                plot_default = wood_Kexp_default,
                title = sprintf("Water potential at which 50perc. of stem cond. is lost (wood_Kexp): %s", wood_Kexp_fit$distn),
                type = "data") 
p + 
  geom_vline(aes(xintercept = wrong_wood_Kexp_default), color = "gray", linetype = "dashed") 
```

Note: here the miscalculation of psi50 in the code barely shows up 
because the value is divided by a large number. 